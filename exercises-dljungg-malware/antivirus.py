import sys
import base64
from Crypto.Cipher import AES



def checkType(payload):
	
	payload2 = "addsadahd"+"ashgdsag"
	payload1 = "dkajhdsk"+"ahsdkajdh"
	if payload2 in payload:
		return 2
	elif payload1 in payload:
		return 1
	return None


def compromised(str1):
	imp = "import base64\nfrom Crypto.Cipher"+" import AES\nkey = base64.b64decode"
	if imp in (str1):
		return True
	return False

def getP(payload_line, cipher):
	data = payload_line.split('(')[1][:-1] 
	c = base64.b64decode("""%s""" % data)
	return cipher.decrypt(c).decode() 


def getC(key):
	kData = key.split('(')[1][:-1] 
	k = base64.b64decode("""%s""" % kData) 
	return AES.new(k) 


def check(file):
	fileString = open(file).read()
	payload = fileString
	if (compromised(fileString)):
		lines = fileString.strip().split("\n")
		print(lines)
		cLine = lines[3]
		key = lines[2]
		iCypher = getC(key)
		payload = getP(cLine, iCypher)
		print (key + cLine)
	pType = checkType(payload)
	return pType
#main1
if __name__ == '__main__':
	check(sys.argv[1])
